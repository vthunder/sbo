
# SBO v0.3 - Simple Blockchain Objects

## Status
Draft

## Overview
The Simple Blockchain Object (SBO) is a minimal data model and envelope format for posting and updating structured objects to a blockchain or data availability layer in a way that supports replication, verification, and mutability. This version (v0.3) assumes a simple base layer with ordered transaction inclusion and no smart contract logic.

SBO defines:
- A human- and machine-readable object envelope
- Rules for posting, updating, transferring, and deleting objects
- A canonical serialization and signature model
- A conflict resolution strategy based on chain order

## Object Identity
Each object is identified by a path and ID of the form:
```
[path/][creator:]id
```
- `path` is an arbitrary string that may be used to group objects. Nested groups are supported (e.g. `nfts/animals/`).
- `creator` is a public key or account identifier of the original creator of the object.
- `id` is the logical identifier generated by the object's creator.

Objects IDs are also part of the [SBO URI Format](#sbo-uri-format-v02) which can be used to fully qualify an object's identity even in more complex scenarios, including cross-chain references and historical states.

Note that the `id` is not globally unique, but it is unique to the creator and path. A given path may have multiple objects with the same ID, but only if they are created by different creators. Any reference that omits the creator must be resolved to the current owner of the object.

## Action Messages
Messages posted on chain are "action messages" and contain a frontmatter envelope and (where appropriate) a payload.

The envelope must contain an `action` field indicating the action being taken. Valid values are:

- `post`: Create a new object or post an updated version. This is the only action used to create or mutate object content or frontmatter.
- `rename`: Rename an object. Requires a `new_id` field.
- `transfer`: Change ownership of an object. Requires a `new_owner` field.
- `delete`: Mark an object as removed. Modeled as a transfer to a null owner (`null:`).

## Envelope Format
The envelope consists of a YAML metadata header followed by the object payload, separated by a `---` marker and a newline.

### Fields
- `schema`: Must be `"SBO-v0.3"`.
- `id`: Object ID of the form `uuid@owner` or `uuid@original-owner@owner`.
- `action`: One of `post`, `transfer`, or `delete`.
- `update_type`: Optional. `"replace"` (default), other values reserved for future merge strategies.
- `new_id`: Required for `rename`.
- `new_owner`: Required for `transfer`.
- `content_type`: MIME type of the object payload.
- `content_schema`: Optional payload schema (e.g. `nft.v1`).
- `encoding`: Transport encoding (e.g. `utf-8`, `gzip`).
- `size`: Size of the decoded content, in bytes.
- `content_hash`: Hash of the decoded payload.
- `content_hash_algorithm`: Hash algorithm used (e.g. SHA-256, Keccak256).
- `related`: List of references to other objects, see below
- `policy_ref`: Optional. Reference to a policy object.
- `signing_key`: Public key that signed the envelope.
- `signature`: Signature over the envelope (see below).
- `---`: End of YAML metadata (followed by a newline).
- [Raw payload]: Starts immediately after `---\n`.

### Related Objects
The `related` field is a list of relationships and target objects. Each entry has:
- `relation`: the type of relation (e.g., 'collection', 'license', etc.)
- `target`: a reference (URI or ID) to the target object

### Signature Scope
The signature covers:
- All bytes from the start of the envelope up to and including the line containing `---\n`.
- The `signature` field itself is excluded entirely from the signed content.

## Conflict Resolution
The canonical state of an object is determined using a Last-Write-Wins (LWW) policy:
- All valid posts to the same ID are applied in blockchain order.
- If an object is updated with `update_type` set to `replace` (the default and currently only update strategy), the latest valid update, based on block height and transaction index, is treated as the current state.

## Action Validity Rules
- Validity of actions will be subject to the policy referenced by `policy_ref`, once implemented. Reserved for future use.
- `post` is idempotent: it may create a new object or update an existing one.
- Only the current owner may post updates, transfers, or deletions for a given object (subject to policy).
- `policy_ref` may only be set by the creator of an object, while the object is owned by said creator (i.e., it is necessary to scan the blockchain to find the last instance of the creator setting the policy for a transferred object)
- `rename` is only valid if the destination ID does not exist by the same creator at the given path.

## Transfer and Delete
- Transfers are automatically moved to the new owner (future: to path `inbox/`)
- Deletes are modeled as transfers to a null owner (`null:`).

## Future Extensions
- The `update_type` field supports future merge strategies (e.g., diffs, CRDTs).
- Support for content-addressed storage (e.g., IPFS) may be added via `storage_ref` in lieu of the payload.

## Example
```
schema: "SBO-v0.3"
id: "random/stuff/hello-world-123"
action: "post"
content_type: "application/json"
encoding: "utf-8"
size: 27
content_hash: "0xabcde12345..."
signing_key: "0xuser1pubkey"
signature: "0xsigneddata"
---
{ "message": "Hello, world!" }
```
